---
title: "capstone"
author: "JIN ZHU"
date: "5/21/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(survival)
library(survminer)
library(Hmisc)
```

```{r}
w1 <- read.csv("wave1.csv")
w2 <- read.csv("wave2.csv")


wave <- rbind(w1, w2)
wave


str(w2)
wave %>% 
  mutate(ed_dt = as.Date(ed_dt, format='%m/%d/%Y'),
         intubation1_dt = as.Date(intubation1_dt, format='%m/%d/%Y'),
         death_dt = as.Date( death_dt,format='%m/%d/%Y'),
         discharge_dt = as.Date(discharge_dt,format='%m/%d/%Y'),
         transfer_out_dt = as.Date(transfer_out_dt , format = '%m/%d/%Y'))
  
  


## ards: Acute respiratory distress syndrome 
## cad: coronary artery disease
## cirrhosis 肝硬化
## rheum. Rheumatoid arthritis is a chronic inflammatory disorder
```

```{r}
# chronic liver disease or gastrointestinal conditions
# - cirrhosis
# - hepatitis
# - ibd(inflammatory bowel disease)

wave <- wave %>%
  # cirrhosis
  mutate(cirrhosis_factor = ifelse(cirrhosis %in% 'Yes', 
                                   'Yes', 
                                   ifelse(cirrhosis == '', NA, 'No'))) %>%
  # inflammatory bowel disease
  mutate(ibd_factor = ifelse(ibd %in% 'Yes', 
                                   'Yes', 
                                   ifelse(ibd == '', NA, 'No'))) %>%
  # hepatitis
  mutate(hep_factor = ifelse(apply(sapply(c('Hepatitis C', 'Hepatitis B'), grepl, hepatitis), 
                                   MARGIN =  1, FUN = any), 
                                   'Yes', 
                                   ifelse(hepatitis == '', NA, 'No')))

# relevel & label
wave$cirrhosis_factor <- factor(wave$cirrhosis_factor,levels=c("No", "Yes"))
label(wave$cirrhosis_factor) <- "Cirrhosis"
wave$ibd_factor <- factor(wave$ibd_factor,levels=c("No", "Yes"))
label(wave$ibd_factor) <- "Inflammatory bowel disease"
wave$hep_factor <- factor(wave$hep_factor,levels=c("No", "Yes"))
label(wave$hep_factor) <- "Hepatitis"
```

```{r}
# COVID GI Symptoms and In-hospital life threatening complications
wave <- wave %>%
        # GI symptoms indicator
  mutate(gi_symptoms = ifelse(grepl("Abdominal Pain|Nausea|Diarrhea", symptoms), 
                              "Yes", 
                              ifelse(symptoms == "", NA, "No")),
         # In-hospital life threatening complications indicator
         life_threat_comp = ifelse(grepl("Septic Shock|Myocardial Infarction|Heart Failure", 
                                         complications),
                                   "Yes", 
                                   ifelse(complications == "", NA, "No")))
```


```{r}
# Covariates
# - Comorbidities:
#   - active_cancer
#   - BMI(obesity)
#   - dm(diabetes)
# - med_count
# - sex
# - race_eth
# - age

wave <- wave %>%
  # cancer
  mutate(cancer_factor = ifelse(apply(sapply(c('Liquid', 'Solid'), grepl, active_cancer), 
                                        MARGIN =  1, FUN = any), 
                                   'Yes', 
                                   ifelse(active_cancer == '', NA, 'No'))) %>%
  # obesity: BMI >= 30
  mutate(bmi = ifelse(bmi == '33.8 | 33.8', 33.8, bmi), 
         bmi = ifelse(bmi == '24.4 | 24.4', 24.4, bmi)) %>%
  mutate(obesity = ifelse(bmi >= 30, 'Yes', ifelse(bmi == '', NA, 'No'))) %>%
  # diabetes
  mutate(dm_factor = ifelse(dm %in% 'Yes', 
                                   'Yes', 
                                   ifelse(dm == '', NA, 'No'))) %>%
  # medication count
  mutate(med_count = ifelse(med_count == '6 | 6 | 6 | 6', 6, 
                            ifelse(med_count == '', NA, med_count))) %>%
  # sex
  mutate(sex = ifelse(sex == 'Female | Female', 'Female', 
                            ifelse(sex == '', NA, sex))) 

# relevel & label

wave$sex = factor(wave$sex,levels=c("Female","Male"))

wave$race_eth = factor(wave$race_eth,levels=c("4","1","2","3","5"))
levels(wave$race_eth)=c("White","Hispanic","Black","Asian","Other")

wave$age_cat = factor(wave$age_cat,levels=c("1","2","3","4","5","6"))
levels(wave$age_cat)=c("18 – 25","26 – 40","41- 55","56 – 70","70 -85","86+")

```


```{r}
# missing values?   find the exposures? exposure pivot_longer/  death: time to death  survival data 
```

# Objective 1
1.	Determine if patients who were hospitalized with GI/Hepatic conditions during the first two waves of COVID 19 were more likely to report having GI symptoms.

Primary exposure: Presence of chronic liver disease or chronic gastrointestinal conditions, including hepatitis B, hepatitis C, cirrhosis, liver transplants, or inflammatory bowel disease. 

Primary outcome: COVID Symptoms, including abdominal pain, nausea or diarrhea.



# Objective 2
2.	Determine if patients hospitalized with GI symptoms during the first two waves of COVID 19 had similar in-hospital outcomes to those who did not report such symptoms.


Primary exposure: COVID Symptoms, including abdominal pain, nausea or diarrhea.

Primary outcome: in-hospital life threatening complications (Septic shock, positive blood culture, renal replacement therapy, arrhythmias, myocardial infarction, heart failure, venous thrombus embolism, coagulation), intubation, or death. 



# Objective 3
3.	Determine in-hospital complications, including mortality among those with GI/Hepatic comorbidities of Covid 19 hospitalizations in a large hospital in NYC 

Primary exposure: Presence of chronic liver disease or chronic gastrointestinal conditions, including hepatitis B, hepatitis C, cirrhosis, liver transplants, or inflammatory bowel disease

Primary outcome: in-hospital life threatening complications (Septic shock, positive blood culture, renal replacement therapy, arrhythmias, myocardial infarction, heart failure, venous thrombus embolism, coagulation), intubation, or death. 



# Objective 4
4.	Describe patient-reported outcomes (PROs) and clinical outcomes among patients with a subset of patients with GI/Hepatic conditions approximately one year after COVID admission (details are in the original proposal). 

Objective 4: Original proposal.

Primary exposure: Presence of chronic liver disease or chronic gastrointestinal conditions, including hepatitis B, hepatitis C, cirrhosis, liver transplants, or inflammatory bowel disease

Primary outcome: Patient Reported Outcomes (PROs): Post Acute Covid Sequalae such as brain fog, cough, shortness of breath, neuropathy, headache, muscle aches, diarrhea, chest pain, abdominal pain, loss of smell taste, fatigue or other.
Clinical outcomes: post hospitalization readmission or death.




